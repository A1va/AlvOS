+ ld obj/kern/kernel
+ mk obj/kern/kernel.img

e820 MEMORY MAP
size: 20, physical address: 0x0000000000000000, length: 0x000000000009fc00, type: reserved
size: 20, physical address: 0x000000000009fc00, length: 0x0000000000000400, type: availiable
size: 20, physical address: 0x00000000000f0000, length: 0x0000000000010000, type: availiable
size: 20, physical address: 0x0000000000100000, length: 0x000000000fee0000, type: reserved
size: 20, physical address: 0x000000000ffe0000, length: 0x0000000000020000, type: availiable
size: 20, physical address: 0x00000000fffc0000, length: 0x0000000000040000, type: availiable

Physical memory: 256M available, base = 636K, extended = 261120K
Using only 261120K of the available memory, npages = 65280.
x64_vm_init: allocate memory for pml4e.
boot_alloc: 
 newSize: 0x1000 
 end of newSize: 0x80046f2000 
 end of usable Mem: 0x8013efd000 
 AlvOS kernel va(0x100000): 0x8004100000 
 mapping base pa(KERNBASE): 0x0 
x64_vm_init: allocate memory for pages[65280].
boot_alloc: 
 newSize: 0xff000 
 end of newSize: 0x80047f1000 
 end of usable Mem: 0x8013efd000 
 AlvOS kernel va(0x100000): 0x8004100000 
 mapping base pa(KERNBASE): 0x0 
x64_vm_init: allocate memory for envs[1024].
boot_alloc: 
 newSize: 0x48000 
 end of newSize: 0x8004839000 
 end of usable Mem: 0x8013efd000 
 AlvOS kernel va(0x100000): 0x8004100000 
 mapping base pa(KERNBASE): 0x0 
pg_size: 0xff000
env_size: 0x48000
KSTKSIZE: 0x10000
kern_size: 0xff00000
check_boot_pml4e() succeeded!
check_page_alloc() succeeded!
check privilege success 8003c03000 ffffffffffffffff
check_page() succeeded!
SMP: CPU 0 found 3 CPU(s)
enabled interrupts: 1 2 4
SMP: CPU 1 starting
SMP: CPU 2 starting
FS is running
FS can do I/O
Device 1 presence: 1
superblock is good
file_open is good
file_get_block is good
running sh -x < testshell.sh | cat
shell produced incorrect output.
expected:
===
# echo hello world | cat
hello world
# cat lorem
Lorem ipsum dolor sit amet, consectetur
adipisicing elit, sed do eiusmod tempor
incididunt ut labore et dolore magna
aliqua. Ut enim ad minim veniam, quis
nostrud exercitation ullamco laboris
nisi ut aliquip ex ea commodo consequat.
Duis aute irure dolor in reprehenderit
in voluptate velit esse cillum dolore eu
fugiat nulla pariatur. Excepteur sint
occaecat cupidatat non proident, sunt in
culpa qui officia deserunt mollit anim
id est laborum.
# cat lorem |num
    1 Lorem ipsum dolor sit amet, consectetur
    2 adipisicing elit, sed do eiusmod tempor
    3 incididunt ut labore et dolore magna
    4 aliqua. Ut enim ad minim veniam, quis
    5 nostrud exercitation ullamco laboris
    6 nisi ut aliquip ex ea commodo consequat.
    7 Duis aute irure dolor in reprehenderit
    8 in voluptate velit esse cillum dolore eu
    9 fugiat nulla pariatur. Excepteur sint
   10 occaecat cupidatat non proident, sunt in
   11 culpa qui officia deserunt mollit anim
   12 id est laborum.
# cat lorem |num |num |num |num |num
    1     1     1     1     1 Lorem ipsum dolor sit amet, consectetur
    2     2     2     2     2 adipisicing elit, sed do eiusmod tempor
    3     3     3     3     3 incididunt ut labore et dolore magna
    4     4     4     4     4 aliqua. Ut enim ad minim veniam, quis
    5     5     5     5     5 nostrud exercitation ullamco laboris
    6     6     6     6     6 nisi ut aliquip ex ea commodo consequat.
    7     7     7     7     7 Duis aute irure dolor in reprehenderit
    8     8     8     8     8 in voluptate velit esse cillum dolore eu
    9     9     9     9     9 fugiat nulla pariatur. Excepteur sint
   10    10    10    10    10 occaecat cupidatat non proident, sunt in
   11    11    11    11    11 culpa qui officia deserunt mollit anim
   12    12    12    12    12 id est laborum.
# lsfd -1
fd 0: name testshell.sh isdir 0 size 113 dev file
fd 1: name <pipe> isdir 0 size 32 dev pipe
fd 3: name <pipe> isdir 0 size 32 dev pipe
# cat script
echo This is from the script.
cat lorem | num | cat
echo These are my file descriptors.
lsfd -1
echo This is the end of the script.
# sh <script
This is from the script.
    1 Lorem ipsum dolor sit amet, consectetur
    2 adipisicing elit, sed do eiusmod tempor
    3 incididunt ut labore et dolore magna
    4 aliqua. Ut enim ad minim veniam, quis
    5 nostrud exercitation ullamco laboris
    6 nisi ut aliquip ex ea commodo consequat.
    7 Duis aute irure dolor in reprehenderit
    8 in voluptate velit esse cillum dolore eu
    9 fugiat nulla pariatur. Excepteur sint
   10 occaecat cupidatat non proident, sunt in
   11 culpa qui officia deserunt mollit anim
   12 id est laborum.
These are my file descriptors.
fd 0: name script isdir 0 size 132 dev file
fd 1: name <pipe> isdir 0 size 32 dev pipe
fd 3: name <pipe> isdir 0 size 32 dev pipe
This is the end of the script.
===
got:
===
# echo hello world | cat
hello world
# cat lorem
===
qemu: terminating on signal 15 from pid 11834
